
# Apply transformation in Mrtrix
mrregister moving.mif template.mif -type nonlinear \
  -nl_warp moving_to_template_warp.mif template_to_moving_warp.mif
  
mrtransform moving.mif transformed_moving.mif \
  -warp moving_to_template_warp.mif \
  -template template.mif

Example:
mrregister data/3102_BL_PD_1/T1_brain.nii.gz data/MNI_2009b_1mm_Brain.nii.gz -type rigid_affine_nonlinear -nl_disp_smooth 2.0 -nl_warp output/moving_to_template.mif output/template_to_moving.mif
mrtransform data/3102_BL_PD_1/T1_brain.nii.gz output/transformed_T1_brain.nii.gz -warp output/moving_to_template.mif -template data/MNI_2009b_1mm_Brain.nii.gz
tcktransform data/dbs_tractography.tck output/template_to_moving.mif output/output_T1_space.tck

# Using transformations generated by ANTS in Mrtrix3
warpinit data/MNI_2009b_1mm_Brain.nii.gz identity_warp[].nii

for i in {0..2}; do     antsApplyTransforms -d 3 -e 0 -i identity_warp${i}.nii -o mrtrix_temp_to_sub_warp${i}.nii -r data/3102_BL_PD_1/T1_brain.nii.gz -t antsInvWarp.nii.gz -t antsAffine.mat  --default-value 2147483647; done

warpcorrect mrtrix_temp_to_sub_warp[].nii final_temp_to_sub_warp.mif -marker 2147483647

tcktransform data/dbs_tractography.tck final_temp_to_sub_warp.mif output.tck


ref= HCP10_MRI/data/959574_StructuralRecommended/959574/T1w/T1w_acpc_dc_restore_brain.nii.gz

patient = HCP10_MRI/data/965367_StructuralRecommended/965367/T1w/T1w_acpc_dc_restore_brain.nii.gz


# Synthmorph
./synthmorph -o moved.nii -t trans.nii data/3102_BL_PD_1/T1w_acpc_dc_restore_brain.nii.gz data/fixed_T1w_acpc_dc_restore_brain.nii.gz

warpconvert trans.nii displacement2deformation trans_deform.mif

tcktransform data/fixed_CC.tck trans_deform.mif output_CC.tck


# FOD estimation
1. Convert to MRtrix format
mrconvert data.nii.gz dwi_preproc.mif -fslgrad bvecs bvals 

2. Estimate the Multi-Tissue Response Functions
dwi2response dhollander dwi_preproc.mif wm.txt gm.txt csf.txt -mask nodif_brain_mask.nii.gz -voxels response_voxels.mif

3. Estimate the FOD
dwi2fod msmt_csd dwi_preproc.mif wm.txt wmfod.mif gm.txt gm.mif csf.txt csf.mif -mask nodif_brain_mask.nii.gz -lmax 8,0,0

4. Perform FOD registration
mrregister moving_wmfod.mif fixed_wmfod.mif -type rigid_affine_nonlinear -nl_warp moving_to_template.mif template_to_moving.mif

5. Tracts registration
tcktransform HCP10_Tracts/959574/tracts_tck/CC.tck moving_to_template.mif output_CC.tck






